{
  inputs = {
    nixpkgs.url = "github:NixOS/nixpkgs/nixos-25.05";
    devshell.url = "github:numtide/devshell";
    flake-parts.url = "github:hercules-ci/flake-parts";
  };

  outputs = { self, nixpkgs, devshell, flake-parts, ... } @ inputs:
    flake-parts.lib.mkFlake { inherit inputs; } {
      imports = [
        devshell.flakeModule
      ];

      systems = [
        "x86_64-linux" "aarch64-darwin"
      ];

      perSystem = { pkgs, system, ... }: let
        deps = with pkgs; rec {
          dev = [
            bc
            cargo
            clang
            cloc
            eplot
            gnuplot
            just
            mdbook
            mdbook-admonish
            mdbook-cmdrun
            mdbook-d2
            mdbook-footnote
            mdbook-pagetoc
            mdbook-pdf
            mdbook-toc
            npm
            openai-whisper
            pandoc
            timg
          ] ++ ci;
          ci = [
          ];
        };
      in {
        packages = {
          ci = pkgs.writeShellApplication {
            name = "ci";
            runtimeInputs = deps.ci;
            text = /* bash */ ''
                            just ci
                            '';
          };
        };
        devshells.default = {extraModulesPath, ...}@args: {
          # imports = ["${extraModulesPath}/language/ruby.nix"];

          # language.ruby.package = pkgs.ruby_3_4;

          motd = ''


####################################################################
#............###..................###..............................#
#............###..................###..............................#
####...###....##...######...###....##...###...######...###...#######
####...###.....#...######...###.....#...###...######...###...#######
####...###............###...###.........###...######...###......####
####...###............###...###.........###...######...###......####
####...###...#.....######...###...#.....###...######...###...#######
####...###...##....######...###...##....###...######...###...#######
#............###...###............###............###...###.........#
#............###...###............###............###...###.........#
#....#####...###......###...######...............###...###...###...#
#.....####...###......###...#####................##.....##...###...#
#...#..###...###.......##...###....####....#######...#...#....##...#
#...##..##...###........#...##....#####....######...###........#...#
#...###..#...###............#....##...........###...###............#
#...###......###......#.........#####.........###...###......#.....#
#...##...#...###......##........#####...#..######...###......##....#
#...#...###.......#...###...#....##....##..#######...#...#...###...#
#......#####.....##...###...##........###........##.....##...###...#
#.....#######...###...###...###......####........###...###...###...#
####################################################################


          '';
          packages = deps.dev;
        };
      };
    };
}
